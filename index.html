<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Simple Chat</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:Arial, sans-serif;}  
  body{background:#0f111a;color:#fff;height:100vh;display:flex;}
  .sidebar{width:280px;background:#151823;border-right:1px solid #222;padding:15px;display:flex;flex-direction:column;}
  .search input{width:100%;padding:10px;border-radius:8px;border:none;background:#1b1f2c;color:#fff;margin-bottom:10px;}
  .contacts{flex:1;overflow-y:auto;margin-top:10px;}
  .contact{padding:10px;background:#1b1f2c;margin-bottom:8px;border-radius:10px;cursor:pointer;}   
  .contact:hover{background:#252a3a;}
  .active{background:#2d3250!important;}
  .chat{flex:1;display:flex;flex-direction:column;}
  .messages{flex:1;padding:20px;overflow-y:auto;}
  .msg{margin-bottom:15px;}
  .me{color:#7fc4ff;}
  .friend{color:#f2a2ff;}
  .inputArea{display:flex;padding:15px;border-top:1px solid #222;} 
  .inputArea input{flex:1;padding:12px;border-radius:8px;border:none;background:#1b1f2c;color:#fff;} 
  .inputArea button{margin-left:10px;padding:12px 18px;border:none;border-radius:8px;background:#4c6ef5;color:#fff;cursor:pointer;} 
  .addFriend{display:flex;margin-top:10px;} 
  .addFriend input{flex:1;padding:10px;border-radius:8px;border:none;background:#1b1f2c;color:#fff;} 
  .addFriend button{margin-left:8px;padding:10px;background:#4c6ef5;border:none;border-radius:8px;color:#fff;cursor:pointer;} 
</style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <div class="search">
    <input id="searchInput" placeholder="Поиск друзей по имени или ID..." />
  </div>

  <div style="font-size:14px;margin-bottom:10px;color:#999;">
    Ваш ID: <span id="myId" style="color:#4c6ef5;font-weight:bold"></span>
  </div>

  <div class="addFriend">
    <input id="friendName" placeholder="Имя друга" />
    <button id="addFriendBtn">+</button>
  </div>

  <div class="contacts" id="contacts"></div>
</div>

<!-- CHAT AREA -->
<div class="chat">
  <div class="messages" id="messages"></div>
  <div class="inputArea">
    <input id="msgInput" placeholder="Написать сообщение..." />
    <button id="sendBtn">Отправить</button>
  </div>
</div>

<script>
// ---------------------------
// STORAGE
// ---------------------------
let state = JSON.parse(localStorage.getItem("simpleChat")) || {
  myId: null,
  contacts: [],
  messages: {}
};

function saveState(){ localStorage.setItem("simpleChat", JSON.stringify(state)); }
function uid(){ return Math.random().toString(36).substring(2,10); }

// ---------------------------
// GENERATE PROFILE ID
// ---------------------------
if(!state.myId){
  state.myId = "id_" + uid();
  saveState();
}

document.getElementById("myId").textContent = state.myId;

// ---------------------------
// RENDER CONTACT LIST
// ---------------------------
let activeChat = null;
const contactsDiv = document.getElementById("contacts");

function renderContacts(filter=""){
  contactsDiv.innerHTML = "";
  state.contacts
    .filter(c=> c.name.toLowerCase().includes(filter.toLowerCase()) || c.id.includes(filter))
    .forEach(c=>{
      const el = document.createElement("div");
      el.className = "contact" + (activeChat===c.id?" active":"");
      el.textContent = c.name + " (" + c.id + ")";
      el.onclick = ()=>{ activeChat = c.id; renderContacts(filter); renderMessages(); };
      contactsDiv.appendChild(el);
    });
}

renderContacts();

// ---------------------------
// ADD FRIEND BY NAME
// ---------------------------
document.getElementById("addFriendBtn").onclick = ()=>{
  const name = friendName.value.trim();
  if(!name) return;
  const id = "id_" + uid();

  state.contacts.push({id,name});
  state.messages[id] = [];
  saveState();

  friendName.value="";
  renderContacts();
};

// ---------------------------
// SEARCH FRIEND BY ID
// ---------------------------
document.getElementById("searchInput").oninput = function(){
  const v = this.value.trim();

  if(/^id_[a-z0-9]{6,}$/.test(v)){
    if(!state.contacts.some(x=>x.id===v)){
      state.contacts.push({id:v,name:"Friend_"+v.slice(-4)});
      state.messages[v] = [];
      saveState();
    }
  }

  renderContacts(v);
};

// ---------------------------
// RENDER MESSAGES
// ---------------------------
function renderMessages(){
  const box = document.getElementById("messages");
  box.innerHTML = "";
  if(!activeChat) return;

  (state.messages[activeChat] || []).forEach(m=>{
    const d=document.createElement("div");
    d.className="msg " + (m.from==="me"?"me":"friend");
    d.textContent = m.text;
    box.appendChild(d);
  });

  box.scrollTop = box.scrollHeight;
}

// ---------------------------
// SEND MESSAGE
// ---------------------------
function send(){
  if(!activeChat) return;
  const input=document.getElementById("msgInput");
  const txt=input.value.trim();
  if(!txt) return;

  state.messages[activeChat].push({from:"me",text:txt});
  saveState();

  input.value="";
  renderMessages();
}

document.getElementById("sendBtn").onclick = send;
document.getElementById("msgInput").onkeydown = e=>{ if(e.key==="Enter") send(); };

</script>
</body>
</html>
